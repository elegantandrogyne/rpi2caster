/**************************************************

       MATRIX:

       program to manipulate the matrix-layout of the
       die-case

       - standard layouts to start with
       - writing and reading on disk
       - changing
       - display on screen



       MONOTYPE program

       coding text-files to monotype code

       control-codes:

       ^00 change to roman
       ^01 change to italic
       ^02 change to small caps
       ^03 change to bold

       ^1| -- ^9| add 1-9 units
       ^1/ -- ^3/ remove 1-3 units

       substracting units inside a word is limited to 1 unit, to prevent
       damage in the character-channel.

       substracting units, is limiting to 4 units minimum, only when
       a space is followed to the character.

       making margins:

       #1n = add 1-9 squares
       #2n = add 1-9 half squares

       ^## all following spaces will be half squares (if possible)

       ^.. all following '...' will be cast as '.','.','.'
	  with 5 units added to the '.' and 5 units placed behind it


****************************************************/


/**************************************************/
/*          includes

    the order of the next includes is sometime
       essential for compiling

	     */
/**************************************************/

#include <stdio.h>
#include <stdlib.h>
#include <conio.h>
#include <dos.h>
#include <io.h>
#include <bios.h>
#include <graph.h>
#include <ctype.h>
#include <fcntl.h>          /* O_ constant definitions */
#include <time.h>
#include <sys\types.h>
#include <sys\stat.h>       /* S_ constant definitions */
#include <malloc.h>
#include <errno.h>
#include <string.h>

/**************************************************/
/*          #define's                             */
/**************************************************/


#define KOLAANTAL 17
#define RIJAANTAL 16

#define NORM      0  /* 15*15 & 17*15   */
#define NORM2     1  /* 17 * 15         */
#define MNH       2  /* 17*16 MNH       1 */
#define MNK       3  /* 17*16 MNK       2 */
#define SHIFT     4  /* 17*16 EF = D, D=shift 2 */
#define SPATIEER  5  /* 0075 = spatieer */

#define FLAT      0  /* flat text */
#define LEFT      1  /* left margin */
#define RIGHT     2  /* right margin */
#define CENTERED  3  /* centered text */

#define FALSE     0
#define TRUE      1

#define LPT1 0
#define MAXTIME 60   /* 60 seconden */
#define FF 12
#define CR 13
#define LF 10
#define MAX_REGELS 60
#define NJK       0x4c
#define NJ        0x44
#define NK        0x48
#define W0075     0x04
#define W0005     0x01
#define SNEEDLE   0x20

#define MAXSTR 100

#define STNUMB 272  /* number of matrices in standard mat-case */


char cnumbuf[MAXSTR] = { MAXSTR + 2, 0 };
#define numbuf cnumbuf + 2          /* Actual buffer starts at byte 3 */


/* File record */

typedef struct matrijs {
     char lig[3];            /* letter inhoud matrijs */
     unsigned char srt;      /* 0=roman 1=italic 2=kk 3=bold */
     unsigned char w;        /* breedte in eenheden */
     unsigned char mrij  ;   /* plaats in matrix    */
     unsigned char mkolom;   /*                      */
};

struct matrijs filerec;

typedef struct rec02 {
	     char cnaam[34];
    unsigned char wedge[16];
    unsigned char corps[10];
    unsigned char csets[10];
} ;


struct rec02 cdata;

struct rec02 stand = {
   "Garamond 156/174/201 series 536",
   5,6,7,8,9,9,10,10,11,12,13,14,15,17,18,0, /* == 0 ? => 17*15 */
   12,16,18,20,22, 24, 28, 32, 36, 48,
   24,32,35,38,41, 45, 51, 56, 64, 86
} ;

struct rec02 stcochin = {
   "Cochin Series                  ",
   5,6,7,8,9,9,9,10,10,11,12,13,14,15,18,0, /* == 0 ? => 17*15 */
   16,20,22,24,26, 28, 0, 0, 0, 0,
   34,42,45,49,53, 60, 0, 0, 0, 0
} ;

struct rec02 stdante12 = {
   "Dante 592 12 Didot             ",
   5,6,7,8,9,9,9,10,10,11,12,13,14,15, 18,0, /* == 0 ? => 17*15 */
   24,0,0,0,0, 0, 0, 0, 0, 0,
   47,0,0,0,0, 0, 0, 0, 0, 0
} ;


struct essentials
{
    FILE *flpt;
    int  aantal;
    char way[_MAX_PATH];
} essin,  essout, essbron ;

/********** globals ******/

char r_buff[MAX_REGELS];
char tc[] = "ONMLKJIHGFsEDgCBA123456789abcdek";

char tb[] = { 0x40, 0x20, 0x10, 0x08, 0x04,
	      0x02, 0x01, 0x80, 0x40, 0x20,
	      0x10, 0x08, 0x04, 0x02, 0x00, 0x00 };

char buff[2000];

/**************************************************/
/*          type defines                          */
/*                                                */
/*          initiation globals                    */
/**************************************************/

char readbuffer[1000] = "abcd^00abcd^01abcd^02abcd^01abcd ffl fi;:;,.'?!MJabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMONPQRSTUVWXYZ";

char opslagbuffer[2000];

unsigned char wig5[16] =  /* 5 wedge */
     { 5,6,7,8,9,9,9,10,10,11,12,13,14,15,17,18 };

unsigned char wig[16] = { 5, 6, 7, 8,  9, 9,10,10, /* 536-wig */
		11,12,13,14, 15,17,18,18 };

unsigned char bembowig[16] = { 5, 6, 7, 8,  9, 9,10,10,
		11,11, 13,14, 15,16,18,18 };


struct invoer_gens {
     char lll[3];
     unsigned char sys;    /* system */
     unsigned char spat; /* spatieeren 0,1,2,3 */
     int kol; /* matrix[uitkomst].mkolom,    kolom 0-16  0 en 1 */
     int row; /* matrix[uitkomst].mrij,      rij   0-15  12 */
     float ww;   /* matrix[uitkomst].w          width char  */
} invoer ;

unsigned int uitkomst;

typedef struct gegevens {
    unsigned char set ;     /* 4 times set                */
    unsigned int  matrices; /* total number of matrices   */
    unsigned char syst;     /* 0 = 15*15 NORM
			       1 = 17*15 NORM2
			       2 = 17*16 MNH
			       3 = 17*16 MNK
			       4 = 17*16 shift
			       */
    unsigned char adding;      /* 0,1,2,3 >0 adding = on     */
    char          pica_cicero; /* p = pica,  c = cicero      */
    float         corp;        /*  5 - 14 in points          */
    float         rwidth;      /* width in pica's/cicero     */
    unsigned int  lwidth;      /* width of the line in units */
    unsigned char fixed;       /* fixed spaces 1/2 corps height */
    unsigned char right;       /* r_ight, l_eft, f_lat, c_entered */
    unsigned char ppp;         /* . . .
				3u + . 3 . 3 . 3.
				3u + !
				3u + ?
			       y/n */

};


struct gegevens central = { 45, 272 , NORM2, 0, 'c',
			    12.0, 24., 200, 'y','r','y' } ;



/*
	   Regular ASCII Chart (character codes 0 - 127)
000   (nul) 00 016  (dle)  032 sp  048 0  064 @  080 P  096 `  112 p
001   (soh) 01 017  (dc1)  033 !   049 1  065 A  081 Q  097 a  113 q
002  (stx) 02 018  (dc2)  034 "   050 2  066 B  082 R  098 b  114 r
003  (etx) 03 019  (dc3)  035 #   051 3  067 C  083 S  099 c  115 s
004  (eot) 04 020  (dc4)  036 $   052 4  068 D  084 T  100 d  116 t
005  (enq) 05 021  25 (nak)  037 %   053 5  069 E  085 U  101 e  117 u
006  (ack) 06 022  (syn)  038 &   054 6  070 F  086 V  102 f  118 v
007  (bel) 07 023  (etb)  039 '   055 7  071 G  087 W  103 g  119 w
008  (bs)  10 024  (can)  040 (   056 8  072 H  088 X  104 h  120 x
009   (tab) 11 025  (em)   041 )   057 9  073 I  089 Y  105 i  121 y
010   (lf)  12 026   (eof)  042 *   058 :  074 J  090 Z  106 j  122 z
011  (vt)  13 027  (esc)  043 +   059 ;  075 K  091 [  107 k  123 {
012  (np)  14
	       028  (fs)   044 ,   060 <  076 L  092 \  108 l  124 |
013   (cr) 15  029  (gs)   045 -   061 =  077 M  093 ]  109 m  125 }
014  (so) 16  030  (rs)   046 .   062 >  078 N  094 ^  110 n  126 ~
015  (si) 17  031  (us)   047 /   063 ?  079 O  095 _  111 o  127 

	    Extended ASCII Chart (character codes 128 - 255)

128 Ä 200  144 ê 220  160 † 240  176 ∞ 260 192 ¿ 280 208 – 300 224 ‡ 320  240 
129 Å 201  145 ë 221  161 ° 241  177 ±     193 ¡     209 —     225 · 321  241 Ò
130 Ç 202  146 í 222  162 ¢ 242  178 ≤     194 ¬     210 “     226 ‚ 322  242 Ú
131 É 203  147 ì 223  163 £ 243  179 ≥     195 √     211 ”     227 „ 323  243 Û
132 Ñ 204  148 î 224  164 § 244  180 ¥     196 ƒ     212 ‘     228 ‰ 324  244 Ù
133 Ö 205  149 ï 225  165 • 245  181 µ     197 ≈     213 ’     229 Â 325  245 ı
134 Ü 206  150 ñ 226  166 ¶ 246  182 ∂     198 ∆     214 ÷     230 Ê 326  246 ˆ
135 á 207  151 ó 227  167 ß 247  183 ∑     199 «     215 ◊     231 Á 327  247 ˜
136 à 210  152 ò 230  168 ® 250  184 ∏     200 »     216 ÿ     232 Ë 330  248 ¯
137 â 211  153 ô 231  169 © 251  185 π     201 …     217 Ÿ     233 È 331  249 ˘
138 ä 212  154 ö 232  170 ™ 252  186 ∫     202       218 ⁄     234 Í 332  250 ˙
139 ã 213  155 õ 233  171 ´ 253  187 ª     203 À     219 €     235 Î 333  251 ˚
140 å 214  156 ú 234  172 ¨ 254  188 º     204 Ã     220 ‹     236 Ï 334  252 ¸
141 ç 215  157 ù 235  173 ≠ 255  189 Ω     205 Õ     221 ›     237 Ì 335  253 ˝
142 é 216  158 û 236  174 Æ 256  190 æ     206 Œ     222 ﬁ     238 Ó 336  254 ˛
143 è 217  159 ü 237  175 Ø 257  191 ø     207 œ     223 ﬂ     239 Ô 337  255

 */

char namestr[34]; /* name font */

unsigned int nrows;

struct matrijs matrix[STNUMB];

struct matrijs stmatrix[ STNUMB ] = {

"j",1,5, 0, 0,  "l",1,5, 0, 1, "i",1,5, 0, 2, ".",0,5, 0, 3, ",",0,5, 0, 4,
"'",0,5, 0, 5,  "j" ,0,5, 0, 6, "i",0,5, 0, 7, " ",0,5, 0, 8,"l",0,5, 0, 9,
"(",0,5, 0,10,  "\214",0,5, 0,11,  "'",1,5, 0,12, ",",1,5, 0,13, "",1,5, 0,14,
"`",1,5, 0,15,  " " ,0,5, 0,16,

"i",  2,6, 1, 0, "\211",1,6, 1, 1, "c",1, 6,1,2, "s",1,6, 1, 3, "f",1,6, 1, 4,
"t",1,6, 1, 5, "e",1,6, 1, 6, "f",0,6, 1, 7," ",1,6, 1, 8, "t",0,6, 1, 9,
"-",0,6, 1,10, ")",0,6, 1,11, "\214",0,6, 1,12, ";",1,6, 1,13, "t",3,6, 1,14,
"[",0,6, 1,15, "]",0,6, 1,16,

"j",2,7, 2, 0, "s",2,7, 2, 1, "\224",1,7, 2, 2, "v",1,7, 2, 3, "y",1,7, 2, 4,
"g",1,7, 2, 5, "r",1,7, 2, 6, "o",1,7, 2, 7, "r",0,7, 2, 8, "s",0,7, 2, 9,
"I",0,7, 2,10, ":",0,5, 2,11, ";",0,5, 2,12, "!",0,5, 2,13, "r",3,7, 2,14,
"I",3,7, 2,15, "-",3,7, 2,16,

"p",2,8, 3, 0, "J",1,8, 3, 1, "I",1,8, 3, 2, "q",1,8, 3, 3, "b",1,8, 3, 4,
"d",1,8, 3, 5, "h",1,8, 3, 6, "n",1,8, 3, 7, "a",1,8, 3, 8, "u",1,8, 3, 9,
"a",0,8, 3,10, "e",0,8, 3,11, "c",0,8, 3,12, "z",0,8, 3,13, "\204",0,8, 3,14,
"\212",0,8, 3,15, "\202",3,8, 3,16,

"y",2,9, 4, 0, "b",2,9, 4, 1, "l",2,9, 4, 2, "e",2,9, 4, 3, "?",1,9, 4, 4,
"!",1,9, 4, 5, "\230",1,9, 4, 6, "p",1,9, 4, 7, " ",2,9, 4, 8, "J",0,8, 4, 9,
"3",0,9, 4,10, "6",0,9, 4,11, "9",0,9, 4,12, "5",0,9, 4,13, "8",0,8, 4,14,
"a",3,9, 4,15, "z",3,9, 4,16,

"z", 2,9, 5, 0, "f",2,9, 5, 1, "t",2,9, 5, 2, "(",1,9, 5, 3, "fi",1,9, 5, 4,
"fl",1,9, 5, 5, "z",1,9, 5, 6, "?",0,9, 5, 7, "x",0,9, 5, 8, "y",0,9, 5, 9,
"7", 0,9, 5,10, "4",0,9, 5,11, "1",0,9, 5,12, "0",1,9, 5,13, "2",3,9, 5,14,
"1",3,9, 5,15, "c",3,9, 5,16,

"x",2,10, 6, 0, "S",1,10, 6, 1, "u",2,10, 6, 2, "o",2,10, 6, 3, "fj",0,10, 6, 4,
"k",1,10, 6, 5, "q",0,10, 6, 6, "h",0,10, 6, 7, "p",0,10, 6, 8, "g",0,10, 6, 9,
"\230",0,10, 6,10, "b",0,10, 6,11, "ff",0,10, 6,12, "fl",3,10, 6,13, "fi",3,10, 6,14,
"y",3,10, 6,15, "S",3,10, 6,16,

"v",2,14, 7, 0, "c",2,14, 7, 1, "r",2,14, 7, 2, "a",2,10, 7, 3, "ff",1,10, 7, 4,
"S",0,10, 7, 5, "v",0,10, 7, 6, "k",0,10, 7, 7, "u",0,10, 7, 8, "n",0,10, 7, 9,
"o",0,10, 7,10, "d",0,10, 7,11, "\224",0,10, 7,12, "\201",0,10, 7,13, "\341",3,10, 7,14,
"\225",0,10, 7,15, "\242",0,10, 7,16,

"k",2,11, 8, 0, "d",2,11, 8, 1, "g",2,11, 8, 2, "n",2,11, 8, 3, "w",1,11, 8, 4,
"x",1,11, 8, 5, "F",0,11, 8, 6, "P",0,11, 8, 7, "u",2,11, 8, 8, "n",2,11, 8, 9,
"\230",3,11, 8,10, "9",3,11, 8,11, "b",3,11, 8,12, "d",3,11, 8,13, "h",3,11, 8,14,
"k",3,11, 8,15, "p",3,11, 8,16,

"Q",1,14, 9, 0, "Y",1,14, 9, 1, "K",1,14, 9, 2, "h",2,12, 9, 3, "m",2,12, 9, 4,
"C",1,14, 9, 5, "L",1,14, 9, 6, "B",0,12, 9, 7, "C",0,12, 9, 8, "L",0,12, 9, 9,
"F",3,12, 9,10, " ",0,12, 9,11, "O",1,14, 9,12, "@",1,12, 9,13, "\200",0,12, 9,14,
"st",1,12, 9,15, "st",0,13, 9,16,

"ffi",1,13,10, 0, "ffl",1,13,10,1, "G",1,15,10, 2, "T",1,13,10, 3, "Z",1,13,10, 4,
"B",1,13,10, 5,   "P",1,13,10, 6,  "U",1,15,10, 7, "m",1,13,10, 8, "E",0,13,10, 9,
"T",0,13,10,10,   "R",0,13,10,11,  "Z",0,13,10,12, "L",3,13,10,13, "B",3,13,10,14,
"C",3,13,10,15,   "Z",3,13,10,16,

"w",2,14,11, 0, "F",1,14,11, 1, "R",1,14,11, 2, "V",0,14,11, 3, "Y",0,14,11, 4,
"A",0,14,11, 5, "U",0,14,11, 6, "w",0,14,11, 7, "A",3,14,11, 8, "E",3,14,11, 9,
"G",3,14,11,10, "T",3,14,11,11, "R",3,14,11,12, "K",3,14,11,13, "V",3,14,11,14,
"X",3,14,11,15, "Y",3,14,11,16,

"fb",0,15,12, 0, "fh",0,15,12, 1, "ffl",0,15,12,2, "Q",0,15,12,3, "X",0,15,12, 4,
"K",0,15,12, 5,  "D",0,15,12, 6,  "G",0,15,12, 7, "H",0,15,12, 8, "N",0,15,12, 9,
"O",0,15,12,10,  "m",0,15,12,11,  "w",3,15,12,12, " ",3,15,12,13, "@",2,15,12,14,
"U",3,15,12,15, "fk",0,15,12,16,

"--",0,17,13, 0, " ",1,17,13, 1, "V",1,17,13, 2, "X",1,17,13, 3, "D",1,17,13, 4,
"H",1,17,13, 5, "N",1,17,13, 6, "A",1,17,13, 7, "M",0,17,13, 8, "&",0,17,13, 9,
"m",3,17,13,10, "ffi",3,17,13,11, "ffl",3,17,13,12, "H",0,17,13,13, "N",0,17,13,14,
"U",3,17,13,15, "ffl",3,17,13,16,

";",1,18,14, 0, "W",1,18,14, 1, " ",0,18,14, 2, "N",1,18,14, 3, "*",0,18,14, 4,
"W",0,18,14, 5, "+",0,18,14, 6, "M",0,18,14, 7, "&",1,18,14, 8, "W",3,18,14, 9,
"=",3,18,14,10, "---",0,18,14,11, "%",0,18,14,12, "---",3,18,14,13, "...",3,18,14,14,
"@",3,18,14,15, " ",0,18,14,16,

"",0,18,15, 0, "",0,18,15, 1, "",0,18,15, 2, "",0,18,15, 3, "",0,18,15, 4,
"",0,18,15, 5, "",0,18,15, 6, "",0,18,15, 7, "",0,18,15, 8, "",3,18,15, 9,
"",0,18,15,10, "",0,18,15,11, "",0,18,15,12, "",0,18,15,13, "",0,18,15,14,
"",0,18,15,15, "",0,18,15,16

} ;


struct matrijs cochin[ STNUMB ] = {

"i\"",0,5, 0, 0,  "i^",0,5, 0, 1, "'",0,5, 0, 2, "`",0,5, 0, 3, ".",0,5, 0, 4,
",",0,5, 0, 5,  "j" ,0,5, 0, 6, "i",0,5, 0, 7, " ",0,5, 0, 8,"l",0,5, 0, 9,
"i'",0,5, 0,10,  "i`",0,5, 0,11,  "i",0,5, 0,12, "i",1,5, 0,13, "l",1,5, 0,14,
"t",1,5, 0,15,  "j",1,5, 0,16,

" ", 0,6, 1, 0, "/",0,6, 1, 1, "[",0, 6,1,2, "]",0,6, 1, 3, "(",0,6, 1, 4,
")",0,6, 1, 5, "-",0,6, 1, 6, "f",0,6, 1, 7," ",1,6, 1, 8, "t",0,6, 1, 9,
"e",0,6, 1,10, "f",0,6, 1,11, "",0,6, 1,12, "r",1,6, 1,13, "s",3,6, 1,14,
"c",1,6, 1,15, "v",1,6, 1,16,

"",0,7, 2, 0, "?",0,7, 2, 1, "?",1,7, 2, 2, "!",0,5, 2, 3, ":",0,5, 2, 4,
";",0,5, 2, 5, "`",1,7, 2, 6, "'",1,7, 2, 7, "r",0,7, 2, 8, "s",0,7, 2, 9,
"o",1,7, 2,10, "p",1,5, 2,11, "b",1,5, 2,12, "q",1,7, 2,13, ";",1,6, 2,14,
":",1,7, 2,15, "!",1,7, 2,16,

"",0,8, 3, 0, "e`",0,8, 3, 1, "e^",0,8, 3, 2, "e\"",0,8, 3, 3, "J",0,8, 3, 4,
"I",0,8, 3, 5, "z",0,8, 3, 6, "c",0,8, 3, 7, "e",0,8, 3, 8, "g",0,8, 3, 9,
"e'",0,8, 3,10, "\207",0,8, 3,11, "u",1,8, 3,12, "n",1,8, 3,13, "d",1,8, 3,14,
"g",1,8, 3,15, "h",1,8, 3,16,

"",0,9, 4, 0, "(",1,9, 4, 1, ")",1,9, 4, 2, "3",0,9, 4, 3, "6",0,9, 4, 4,
"9",0,9, 4, 5, "\230",0,9, 4, 6, "y",0,9, 4, 7, " ",2,9, 4, 8, "p",0,8, 4, 9,
"b",0,9, 4,10, "\223",0,9, 4,11, "y",1,9, 4,12, "z",1,9, 4,13, "9",1,8, 4,14,
"3",1,9, 4,15, "6",1,9, 4,16,

"\341", 0,9, 5, 0, "u\"",0,9, 5, 1, "u'",0,9, 5, 2, "7",0,9, 5, 3, "4",0,9, 5, 4,
"1",0,9, 5, 5, "0",0,9, 5, 6, "q",0,9, 5, 7, "u",0,9, 5, 8, "a",0,9, 5, 9,
"k", 0,9, 5,10, "u^",0,9, 5,11, "x",1,9, 5,12, "0",1,9, 5,13, "1",1,9, 5,14,
"4",1,9, 5,15, "7",1,9, 5,16,

"o'",0,9, 6, 0, "o`",0,9, 6, 1, "o^",0,9, 6, 2, "2",0,9, 6, 3, "5",0,9, 6, 4,
"8",0,9, 6, 5, "--",0,9, 6, 6, "v",0,9, 6, 7, "o",0,9, 6, 8, "h",0,9, 6, 9,
"fi",0,9, 6,10, "u`",0,9, 6,11, "a",1,9, 6,12, "w",1,9, 6,13, "8",1,9, 6,14,
"5",1,9, 6,15, "2",1,9, 6,16,

"",0,9, 7, 0, "",0,9, 7, 1, "+",0,9, 7, 2, "a\"",0,9, 7, 3, "a'",0,10, 7, 4,
"n",0,10, 7, 5, "*",0,9, 7, 6, "x",0,9, 7, 7, "n",0,9, 7, 8, "d",0,9, 7, 9,
"fl",0,9, 7,10, "a`",0,9, 7,11, "a^",0,9, 7,12, "k",1,9, 7,13, "I",1,9, 7,14,
"j",1,9, 7,15, "",0,9, 7,16,

"",0,11, 8, 0, "",0,11, 8, 1, "",0,11, 8, 2, "",0,11, 8, 3, "",0,11, 8, 4,
"ff",1,11, 8, 5, "",0,11, 8, 6, "S",0,11, 8, 7, "ff",0,11, 8, 8, "",0,11, 8, 9,
"\221",1,11, 8,10, "oe!",1,11, 8,11, "fl",1,11, 8,12, "fi",1,11, 8,13, "F",1,11, 8,14,
"S",1,11, 8,15, "p",3,11, 8,16,

"",0,12, 9, 0, "",0,12, 9, 1, "",0,12, 9, 2, "",0,12, 9, 3, "F",0,12, 9, 4,
"L",0,12, 9, 5, "P",0,12, 9, 6, "T",0,12, 9, 7, "m",1,12, 9, 8, "O",1,12, 9, 9,
"T",1,12, 9,10, "B",1,12, 9,11, "C",1,12, 9,12, "G",1,12, 9,13, "P",0,12, 9,14,
"Q",1,12, 9,15, "Z",1,12, 9,16,

"E\"",0,13,10, 0, "E`",0,13,10,1, "\234",0,13,10, 2, "Z",0,13,10, 3, "B",0,13,10, 4,
"E",0,13,10, 5,   "ffi",0,13,10, 6,  "ffl",0,13,10, 7, "m",0,13,10, 8, "L'",1,13,10, 9,
"oe!",0,13,10,10,   "A",1,13,10,11,  "E",1,13,10,12, "L",1,13,10,13, "R",1,13,10,14,
"",0,13,10,15,   "",0,13,10,16,

"&",0,14,11, 0, "",0,14,11, 1, "\222",0,14,11, 2, "K",0,14,11, 3, "C",0,14,11, 4,
"G",0,14,11, 5, "R",0,14,11, 6, "A",0,14,11, 7, "w",0,14,11, 8, "ffl",1,14,11, 9,
"ffi",1,14,11,10, "D",1,14,11,11, "N",1,14,11,12, "V",1,14,11,13, "Y",1,14,11,14,
"N",1,14,11,15, "",0,14,11,16,

"",0,15,12, 0, "",0,15,12, 1, "",0,15,12,2, "",0,15,12,3, "V",0,15,12, 4,
"X",0,15,12, 5,  "Y",0,15,12, 6,  "N",0,15,12, 7, "U",0,15,12, 8, "U",1,15,12, 9,
"H",1,15,12,10,  "",0,15,12,11,  "",0,15,12,12, "",0,15,12,13, "",0,15,12,14,
"",0,15,12,15, "\232",0,15,12,16,

"",0,16,13, 0, "",0,16,13, 1, "",0,16,13, 2, "",0,16,13, 3, "W",0,16,13, 4,
"Q",0,16,13, 5, "D",0,16,13, 6, "H",0,16,13, 7, "O",0,16,13, 8, "K",1,16,13, 9,
"X",1,16,13,10, "&",1,16,13,11, "O^",3,16,13,12, "O\"",0,16,13,13, "O'",0,16,13,14,
"O`",0,16,13,15, "",0,16,13,16,

"",0,18,14, 0, "---",0,18,14, 1, "+",3,18,14, 2, "",0,18,14, 3, "M",0,18,14, 4,
"",1,20,14, 5, "",0,18,14, 6, "\222",1,18,14, 7, "",0,18,14, 8, "M",1,18,14, 9,
"",0,18,14,10, "OE!",1,18,14,11, "",0,18,14,12, "W",1,18,14,13, "",0,18,14,14,
"\222",0,20,14,15, " ",4,18,14,16,

"",0,18,15, 0, "",0,18,15, 1, "",0,18,15, 2, "",0,18,15, 3, "",0,18,15, 4,
"",0,18,15, 5, "",0,18,15, 6, "",0,18,15, 7, "",0,18,15, 8, "",0,18,15, 9,
"",0,18,15,10, "",0,18,15,11, "",0,18,15,12, "",0,18,15,13, "",0,18,15,14,
"",0,18,15,15, "",0,18,15,16

} ;

struct matrijs stdante[ STNUMB ] = {

"i",2,5, 0, 0,  "`",0,5, 0, 1, "'",0,5, 0, 2, ",",0,5, 0, 3, ".",0,5, 0, 4,
"i\"",0,5, 0, 5,  "i^" ,0,5, 0, 6, "i",0,5, 0, 7, " ",0,5, 0, 8,"i",1,5, 0, 9,
"l",1,5, 0,10,  "j",1,5, 0,11,  "i^",1,5, 0,12, "i\"",1,5, 0,13, "",1,5, 0,14,
"'",1,5, 0,15,  " ",5,5, 0,16,

"j",2,6, 1, 0, "(",0,6, 1, 1, ")",0, 6,1,2, "[",0,6, 1, 3, "]",0,6, 1, 4,
"I",0,6, 1, 5, "l",0,6, 1, 6, "f",0,6, 1, 7," ",1,6, 1, 8, "j",0,6, 1, 9,
"-",0,6, 1,10, "",0,6, 1,11, "t",1,6, 1,12, "f",1,6, 1,13, "/",0,6, 1,14,
"I",1,6, 1,15, "J",1,6, 1,16,

"",0,7, 2, 0, "\"",0,7, 2, 1, "s",2,7, 2, 2, "!",0,7, 2, 3, ":",0,7, 2, 4,
";",0,7, 2, 5, "J",0,7, 2, 6, "s",0,7, 2, 7, "t",0,7, 2, 8, "\207",1,7, 2, 9,
"e",1,7, 2,10, "s",1,7, 2,11, "c",1,7, 2,12, "e^",1,5, 2,13, "e\"",1,7, 2,14,
"e`",1,7, 2,15, "e'",1,7, 2,16,

"",0,8, 3, 0, "",0,8, 3, 1, "",0,8, 3, 2, "*",0,8, 3, 3, "?",0,8, 3, 4,
"f",2,8, 3, 5, "\207",0,8, 3, 6, "c",0,8, 3, 7, "r",0,8, 3, 8, "o",1,8, 3, 9,
"r",1,8, 3,10, "o^",1,8, 3,11, ";",1,8, 3,12, ":",1,8, 3,13, "!",1,8, 3,14,
"",0,8, 3,15, "",0,8, 3,16,

"''",0,9, 4, 0, "b",2,9, 4, 1, "e",2,9, 4, 2, "1",0,9, 4, 3, "2",0,9, 4, 4,
"3",0,9, 4, 5, "S",0,9, 4, 6, "e`",0,9, 4, 7, " ",2,9, 4, 8, "e'",0,9, 4, 9,
"?",1,9, 4,10, "k",1,9, 4,11, "b",1,9, 4,12, "S",1,9, 4,13, "3",1,8, 4,14,
"2",1,9, 4,15, "1",1,9, 4,16,

"``", 0,9, 5, 0, "t",2,9, 5, 1, "p",2,9, 5, 2, "4",0,9, 5, 3, "5",0,9, 5, 4,
"6",0,9, 5, 5, "7",0,9, 5, 6, "a^",0,9, 5, 7, "a",0,9, 5, 8, "a`",0,9, 5, 9,
"g",1,9, 5,10, "h",1,9, 5,11, "v",1,9, 5,12, "7",1,9, 5,13, "6",1,9, 5,14,
"5",1,9, 5,15, "4",1,9, 5,16,

"\25",0,9, 6, 0, "y",2,9, 6, 1, "l",2,9, 6, 2, "8",0,9, 6, 3, "9",0,9, 6, 4,
"0",0,9, 6, 5, "--",0,9, 6, 6, "e^",0,9, 6, 7, "e",0,9, 6, 8, "z",0,9, 6, 9,
"e\"",0,9, 6,10, "a",1,9, 6,11, "y",1,9, 6,12, "q",1,9, 6,13, "0",1,9, 6,14,
"9",1,9, 6,15, "8",1,9, 6,16,

"+",1,10, 7, 0, "x",2,10, 7, 1, "k",2,14, 7, 2, "u",2,10, 7, 3, "c",2,10, 7, 4,
"F",0,10, 7, 5, "g",0,10, 7, 6, "y",0,10, 7, 7, "o",0,10, 7, 8, "d",1,10, 7, 9,
"x",1,10, 7,10, "z",1,10, 7,11, "p",1,10, 7,12, "fi",1,10, 7,13, "fl",1,10, 7,14,
"L",1,10, 7,15, "?",1,10, 7,16,

"v",2,10, 8, 0, "g",2,10, 8, 1, "z",2,10, 8, 2, "r",2,10, 8, 3, "a",2,10, 8, 4,
"v",0,10, 8, 5, "",0,10, 8, 6, "o^",0,10, 8, 7, "x",0,10, 8, 8, "n",1,10, 8, 9,
"u",1,10, 8,10, "u^",1,10, 8,11, "u\"",1,10, 8,12, "u`",1,10, 8,13, "n~",1,10, 8,14,
"B",1,10, 8,15, "F",1,10, 8,16,

"d",2,11, 9, 0, "n",2,11, 9, 1, "P",0,11, 9, 2, "u`",0,11, 9, 3, "fl",0,11, 9, 4,
"fi",0,11, 9, 5, "d",0,11, 9, 6, "q",0,11, 9, 7, "p",0,11, 9, 8, "n",0,11, 9, 9,
"h",0,11, 9,10, "u",0,11, 9,11, "b",0,11, 9,12, "k",0,11, 9,13, "E",1,11, 9,14,
"P",1,11, 9,15, "Z",1,11, 9,16,

"m",2,12,10, 0, "o",2,12,10,1, "X",0,12,10, 2, "Y",0,12,10, 3, "B",0,12,10, 4,
"L",0,12,10, 5,   "E",0,12,10, 6,  "h",2,12,10, 7, "q",2,12,10, 8, "ff",0,12,10, 9,
"ff",1,12,10,10,   "\24",0,12,10,11,  "T",1,12,10,12, "C",1,12,10,13, "Y",1,12,10,14,
"K",1,12,10,15,   "X",3,12,10,16,

"ae",2,13,11, 0, "K",0,13,11, 1, "Z",0,13,11, 2, "C",0,13,11, 3, "R",0,13,11, 4,
"T",0,13,11, 5, "oe",1,13,11, 6, "ae",1,13,11, 7, "",0,13,11, 8, "A",1,13,11, 9,
"",0,13,11,10, "",0,13,11,11, "O",1,13,11,12, "G",1,13,11,13, "R",1,13,11,14,
"U",3,13,11,15, "Q",1,13,11,16,

"",0,14,12, 0, "",0,14,12, 1, "",0,14,12,2, "",0,14,12,3, "",0,14,12, 4,
"V",0,14,12, 5,  "U",0,14,12, 6,  "G",0,14,12, 7, "A",0,14,12, 8, "ae",0,14,12, 9,
"m",1,14,12,10,  "w",1,14,12,11,  "D",1,14,12,12, "N",1,14,12,13, "H",1,14,12,14,
"V",1,14,12,15, "",0,14,12,16,

"",0,15,13, 0, "w",2,15,13, 1, "oe",2,15,13, 2, "OE",0,20,13, 3, "Q",0,15,13, 4,
"H",0,15,13, 5, "O",0,15,13, 6, "D",0,15,13, 7, "N",0,15,13, 8, "",0,15,13, 9,
"W",0,20,13,10, "w",0,15,13,11, "oe",0,15,13,12, "ffi",1,15,13,13, "ffl",1,15,13,14,
"",0,15,13,15, "W",1,20,13,16,

"%",0,18,14, 0, "AE",0,18,14, 1, "&",0,18,14, 2, "M",1,18,14, 3, "+",0,18,14, 4,
"ffl",0,18,14, 5, "--",0,18,14, 6, "ffi",0,18,14, 7, "=",0,18,14, 8, "m",0,18,14, 9,
"OE",1,18,14,10, "M",0,18,14,11, "AE",1,18,14,12, "..",3,18,14,13, "OE",1,18,14,14,
"---",3,18,14,15, " ",0,18,14,16,

"",0,18,15, 0, "",0,18,15, 1, "",0,18,15, 2, "",0,18,15, 3, "",0,18,15, 4,
"",0,18,15, 5, "",0,18,15, 6, "",0,18,15, 7, "",0,18,15, 8, "",0,18,15, 9,
"",0,18,15,10, "",0,18,15,11, "",0,18,15,12, "",0,18,15,13, "",0,18,15,14,
"",0,18,15,15, "",0,18,15,16

} ;

struct rec02 stbaskerv = {
   "Baskerville series 169/312     ",
   5,6,7,8,8,9, 9,10,10,11,12,13,14,15,18,0, /* == 0 ? => 17*15 */
   12,16,18,19,20, 22, 24, 28, 32, 36,
   27,33,36,38,40, 43, 48, 52, 58, 62
} ;

struct matrijs baskerville[ STNUMB ] = {

"i",2,5, 0, 0,  "j",1,5, 0, 1, "l",1,5, 0, 2, "i",1,5, 0, 3, "'",0,5, 0, 4,
"f",0,5, 0, 5,  "i" ,0,5, 0, 6, "i",0,5, 0, 7, " ",0,5, 0, 8,"l",0,5, 0, 9,
"j",0,5, 0,10,  ".",0,5, 0,11,  ",",0,5, 0,12, ".",3,5, 0,13, ",",3,5, 0,14,
"'",3,5, 0,15,  "(",3,5, 0,16,

"s", 2,6, 1, 0, "j",2,6, 1, 1, "e\"",1, 6,1,2, "r",1,6, 1, 3, "s",1,6, 1, 4,
"f",1,6, 1, 5, ")",3,6, 1, 6, "e",1,6, 1, 7, " ",1,6, 1, 8, "c",1,6, 1, 9,
"s",0,6, 1,10, "t",0,6, 1,11, "-",0,6, 1,12, "l",3,6, 1,13, "j",3,6, 1,14,
"i",3,6, 1,15, "-",3,6, 1,16,

"I",1,7, 2, 0, "y",1,7, 2, 1, "o\"",1,7, 2, 2, "v",1,5, 2, 3, "o",1,5, 2, 4,
"a",1,5, 2, 5, ";",1,7, 2, 6, "ff",1,9, 2, 7, ")",0,7, 2, 8, "(",0,7, 2, 9,
"r",0,7, 2,10, "!",0,5, 2,11, "f",3,5, 2,12, "t",3,7, 2,13, ":",3,6, 2,14,
";",3,7, 2,15, "I",3,7, 2,16,

"f",2,8, 3, 0, "q",1,8, 3, 1, "fl",1,8, 3, 2, "e^",0,8, 3, 3, "a`",1,8, 3, 4,
";",1,8, 3, 5, ":",1,8, 3, 6, "e`",0,8, 3, 7, "h",1,8, 3, 8, "g",1,8, 3, 9,
"fi",1,8, 3,10, "b",1,8, 3,11, "d",1,8, 3,12, "e",0,8, 3,13, "c",0,8, 3,14,
"e\"",1,8, 3,15, "?",0,8, 3,16,

"k",1,8, 4, 0, "z",1,8, 4, 1, "x",1,8, 4, 2, "!",1,8, 4, 3, "\207",0,8, 4, 4,
"e'",0,8, 4, 5, "a'",1,8, 4, 6, "?",1,8, 4, 7, "u",1,8, 4, 8, "a",1,8, 4, 9,
"n",1,8, 4,10, "h",1,8, 4,11, "a\"",1,8, 4,12, "u\"",1,8, 4,13, "z",0,8, 4,14,
"I",0,8, 4,15, "J",0,8, 4,16,

"l", 2,9, 5, 0, "p",2,9, 5, 1, "t",2,9, 5, 2, "3",0,9, 5, 3, "9",0,9, 5, 4,
"6",0,9, 5, 5, "5",0,9, 5, 6, "2",0,9, 5, 7, " ",2,9, 5, 8, "S",1,9, 5, 9,
"g", 0,9, 5,10, "y",0,9, 5,11, "k",0,9, 5,12, "a\"",1,9, 5,13, "c",3,9, 5,14,
"s",3,9, 5,15, "z",3,9, 5,16,

"z",2,9, 6, 0, "b",2,9, 6, 1, "c",2,9, 6, 2, "7",0,9, 6, 3, "4",0,9, 6, 4,
"1",0,9, 6, 5, "0",0,9, 6, 6, "8",0,9, 6, 7, "e",2,9, 6, 8, "o",0,9, 6, 9,
"a",0,9, 6,10, "v",0,9, 6,11, "x",0,9, 6,12, "o\"",1,9, 6,13, "e",3,9, 6,14,
"r",3,9, 6,15, "J",3,9, 6,16,

"q",2,10, 7, 0, "k",2,10, 7, 1, "J",1,10, 7, 2, "g",2,10, 7, 3, "u",2,10, 7, 4,
"ij",1,10, 7, 5, "F",1,10, 7, 6, "C",1,10, 7, 7, "p",0,10, 7, 8, "q",0,10, 7, 9,
"b",0,10, 7,10, "d",0,10, 7,11, "u\"",3,10, 7,12, "g",3,10, 7,13, "fi",0,10, 7,14,
"fl",0,10, 7,15, "y",3,10, 7,16,

"x",2,10, 8, 0, "v",2,10, 8, 1, "r",2,10, 8, 2, "n",2,10, 8, 3, "o",2,10, 8, 4,
"a",2,10, 8, 5, "d",2,10, 8, 6, "h",0,10, 8, 7, "n",0,10, 8, 8, "u",0,10, 8, 9,
"ij",0,10, 8,10, "S",0,10, 8,11, "a",3,10, 8,12, "o",3,10, 8,13, "v",3,10, 8,14,
"S",3,10, 8,15, "x",3,10, 8,16,

"h",2,11, 9, 0, "m",2,11, 9, 1, "L",1,11, 9, 2, "P",1,11, 9, 3, "B",0,11, 9, 4,
"F",0,11, 9, 5, "P",0,11, 9, 6, "ij",2,11, 9, 7, "p",3,11, 9, 8, "u",3,11, 9, 9,
"n",3,11, 9,10, "h",3,11, 9,11, "b",3,11, 9,12, "d",3,11, 9,13, "k",3,11, 9,14,
"q",3,11, 9,15, "F",1,11, 9,16,

"V",1,12,10, 0, "Z",1,12,10, 1, "G",1,12,10, 2, "R",1,12,10, 3, "B",1,12,10, 4,
"A",1,12,10, 5, "E",1,12,10, 6, "w",1,12,10, 7, "m",1,12,10, 8, "E",0,12,10, 9,
"L",0,12,10,10, "Z",0,12,10,11, "E",3,12,10,12, "L",3,12,10,13, "B",3,12,10,14,
"P",3,12,10,15, "Z",3,12,10,16,

"ae",2,13,11, 0, "O\"",1,13,11, 1, "K",1,13,11, 2, "Q",1,13,11, 3, "X",1,13,11, 4,
"O",1,13,11, 5, "Y",0,13,11, 6, "C",0,13,11, 7, "A",0,13,11, 8, "T",1,13,11, 9,
"w",0,13,11,10, "ff",3,13,11,11, "ae",3,13,11,12, "A",3,13,11,13, "C",3,13,11,14,
"T",3,13,11,15, "Y",3,13,11,16,

"w",2,14,12, 0, "D",1,14,12, 1, "H",1,14,12, 2, "N",1,14,12, 3, "T",0,14,12, 4,
"U",1,14,12, 5, "V",0,14,12, 6, "D",0,14,12, 7, "G",0,14,12, 8, "N",1,14,12, 9,
"R",1,14,12,10, "U",3,14,12,11, "D",3,14,12,12, "G",3,14,12,13, "N",3,14,12,14,
"R",3,14,12,15, "V",3,14,12,16,

"&",0,15,13, 0, "ffl",0,15,13, 1, "U\"",0,15,13, 2, "K",0,15,13, 3, "U",0,15,13, 4,
"X",0,15,13, 5, "H",0,15,13, 6, "O",0,15,13, 7, "m",0,15,13, 8, "w",3,15,13, 9,
"O",3,15,13,10, "H",3,15,13,11, "K",3,15,13,12, "ffi",0,15,13,13, "Q",0,15,13,14,
"Q",3,15,13,15, "X",3,15,13,16,

"3/4",0,18,14, 0, "W",1,18,14, 1, "1/4",3,18,14, 2, "M",1,18,14, 3, "+",0,18,14, 4,
"W",0,20,14, 5, "*",0,18,14, 6, "M",0,18,14, 7, "",0,18,14, 8, "m",3,18,14, 9,
"=",0,18,14,10, "M",3,18,14,11, "%",0,18,14,12, "W",3,18,14,13, "+-",0,18,14,14,
"---",0,20,14,15, " ",4,18,14,16,

"",0,18,15, 0, "",0,18,15, 1, "",0,18,15, 2, "",0,18,15, 3, "",0,18,15, 4,
"",0,18,15, 5, "",0,18,15, 6, "",0,18,15, 7, "",0,18,15, 8, "",0,18,15, 9,
"",0,18,15,10, "",0,18,15,11, "",0,18,15,12, "",0,18,15,13, "",0,18,15,14,
"",0,18,15,15, "",0,18,15,16

} ;



int matmax = 272;
int mnumb;   /* global : mnumb = number of mats in the mat-case */

unsigned char char_set = 45 ;      /* set garamond 12 pnt */

unsigned char cbuff[256];


unsigned char kolcode[KOLAANTAL][4] = {
/*   NI  */   0x42,    0,  0,  0,
/*   NL  */   0x50,    0,  0,  0,
/*   A   */      0,    0, 0x80,  0,
/*   B   */      0,    1,  0,  0,
/*   C   */      0,    2,  0,  0,
/*   D   */      0,    8,  0,  0,
/*   E   */      0, 0x10,  0,  0,
/*   F   */      0, 0x40,  0,  0,
/*   G   */      0, 0x80,  0,  0,
/*   H   */      1,    0,  0,  0,
/*   I   */      2,    0,  0,  0,
/*   J   */      4,    0,  0,  0,
/*   K   */      8,    0,  0,  0,
/*   L   */   0x10,    0,  0,  0,
/*   M   */   0x20,    0,  0,  0,
/*   N   */   0x40,    0,  0,  0,
/*   O   */   0x80,    0,  0,  0

};

unsigned char rijcode[RIJAANTAL][4] = {
/*  0  */     0, 0, 0x40, 0,
/*  1  */     0, 0, 0x20, 0,
/*  2  */     0, 0, 0x10, 0,
/*  3  */     0, 0,    8, 0,
/*  4  */     0, 0,    4, 0,
/*  5  */     0, 0,    2, 0,
/*  6  */     0, 0,    1, 0,
/*  7  */     0, 0,    0, 0x80,
/*  8  */     0, 0,    0, 0x40,
/*  9  */     0, 0,    0, 0x20,
/*  a  */     0, 0,    0, 0x10,
/*  b  */     0, 0,    0,    8,
/*  c  */     0, 0,    0,    4,
/*  d  */     0, 0,    0,    2,
/*  e  */     0, 0,    0,    0,
/*  f  */     0, 0,    0,    0
};

unsigned char kcd[4]      = {    0,   0, 0, 1 };
unsigned char gcd[4]      = {    0,0x04, 0, 0 };
unsigned char Scd[4]      = {    0,0x20, 0, 0 };
unsigned char NJcd[4]     = { 0x44,   0, 0, 0 };
unsigned char NJgkcd[4]   = { 0x44,0x84, 0, 1 };
unsigned char NKJcd[4]    = { 0x4c,   0, 0, 0 };
unsigned char NKJgkcd[4]  = { 0x4c,0x84, 0, 1 };
unsigned char NKkcd[4]    = { 0x48,   0, 0, 1 };

unsigned char u1, u2 ;    /* uitvul cijfers */
unsigned char las[2];  /* lascijfers */

/***********************************************************/
/*                                                         */
/*                   routine-declarations                  */
/*                                                         */
/***********************************************************/

void getchmain();
void pri_lig( struct matrijs *m );

void pri_str( char b[]);
void wis_str( char b[]);
void crlf();

int  pri_num(int numb,int l);

int  get_line();
void cls();
void ontsnap   (char c[] );

void convert( struct matrijs *m );



unsigned int  lees_lig(void);
unsigned char lees_srt( char *b );
unsigned char lees_width(unsigned char w);

unsigned int askcol(void );
unsigned int askrow(void);
void pri_coln  (int column);
void maprint   (void);
char r_eading  (void);
char nieuw     (void);
int  schrijf   (void);
void editen    (void);
char standaard (void);
char menu(char gelezen );
void displaym  (void);



void print_at    ( int rij, int kolom, char *buf);
		/* print string at row, column */
void intro       ( void );
void scherm      ( void );
void scherm2     ( void );
void scherm3     ( void );



/**********************************************************/

/*                 function definitions                   */

/**********************************************************/

void intro(void)
{
   char com;
   scherm();

   do {
      print_at( 3,28,   "Test version 28 december 2003");

      print_at( 4,28,    "computer controlled casting");
      print_at( 5,26,  "on Monotype composition casters");
      print_at( 7,30,      "reading matrix-layout" );
      print_at( 9,36,           "copyright:");

      print_at(11,33,         "John Cornelisse");

      print_at(13,28,    "letterpress & typefounding");
      print_at(14,35,          "Vaartstraat 23");
      print_at(15,33,         "4553AN Philippine");
      print_at(16,33,         "Zeeuws Vlaanderen");
      print_at(17,34,          "The Netherlands");
      print_at(18,32,        "+31 (0) 115 491 184");
      print_at(19,30,     "email: enkidu@zeelandnet.nl");

      print_at(21,33,           "proceed ? (y/n)");
      print_at(21,48,                 " ");
      get_line();
      com = r_buff[0];
   }
     while (com!='y' && com !='j'&& com !='n');
   if (com == 'n') exit(1);
   cls();
}

void pri_coln(int column) /* prints column name */
{
   switch (column) {
      case 0 : printf("NI");break;
      case 1 : printf("NL");break;
      default :
      printf(" %1c",63+column ); /* column A = 2 asc 65=A */
      break;
   }
}

void pri_str( char b[])
{
   int i;

   for (i=0;i<=79 && b[i] != '\0' ;i++) {
      _bios_printer(_PRINTER_WRITE, LPT1, b[i]);
   }
   crlf();
}

void wis_str( char b[] )
{
   int i;
   for (i=0;i<=79;i++) b[i]=' '; b[80]='\0';
}

int pri_num(int numb,int l)
{
    int i,j,in;
    char cb[5] = "     ";

    cls();
    in = numb;

    i = 0; j = 0;
    while ( in >= 1 ) {
       cb[4-i]=(in % 10 )+48;
       in /= 10;
       i++; j++;
    }
    for (i=5-l;i<5;i++){
       printf("%1c",cb[i]);
    }
    return (j);
}

void crlf()
{
   _bios_printer(_PRINTER_WRITE, LPT1, 13);
   _bios_printer(_PRINTER_WRITE, LPT1, 10);
}

/*
   print out matrix layout on the printer
 */

void maprint( void )
{
   int i,j,k,l;
   char pbuff[82];
   char c;
   char w[] = "Wedge ";
   char p[] = "corps ";
   char s[] = "set   ";

   double fl;

   unsigned pstatus;

   cls();
   printf("print layout op printer\n");

   pri_str(cdata.cnaam);
   crlf();

   wis_str( pbuff );
   for (i=0;i<5;i++) pbuff[i+2]=w[i];  /* wedge */
   for (i=0;i<15;i++) {
       if ( cdata.wedge[i]>0 ) {
	   if ( (i+1)>9) {
	       pbuff[8+i*3]='1';
	   }
	   pbuff[9+i*3]= (i+1) % 10 + '0';
       }
   }
   pbuff[60]='\0';
   pri_str(pbuff);
   wis_str( pbuff );
   for (i=0;i<15;i++) {
       if ( cdata.wedge[i]>0 ) {
	   if ( cdata.wedge[i] > 9 ) {
	       pbuff[8+i*3]= cdata.wedge[i] / 10 +'0';
	   }
	   pbuff[9+i*3]= cdata.wedge[i] % 10 + '0';
       }
   }
   pbuff[75]='\0';

   pri_str(pbuff);
   wis_str( pbuff );
   for (i=0;i<6;i++) pbuff[i+2] = p[i]; /* corps */
   for (i=0;i<9;i++) {
       k = cdata.corps[i];
       if ( k > 0 ) {
	  if ( (k % 2) == 1) {
	     pbuff[10+i*6] = '.';
	     pbuff[11+i*6] = '5';
	  }
	  k /= 2;
	  if (k>=10) {
	     pbuff[8+i*6] = (k/10) + '0';
	  }
	  pbuff[9+i*6] = (k % 10) + '0';
       }
   }
   pbuff[75]='\0';

   pri_str(pbuff);

   wis_str( pbuff );
   for (i=0;i<6;i++) pbuff[i+2] = s[i]; /* set */
   for (i=0;i<9;i++) {
       k = cdata.csets[i];
       if ( k > 0 ) {
	  pbuff[10+i*6] = '.';
	  switch (k%4) {
	    case 1 : pbuff[11+i*6] = '2'; pbuff[12+i*6] = '5';
	      break;
	    case 2 : pbuff[11+i*6] = '5'; pbuff[12+i*6] = '0';
	      break;
	    case 3 : pbuff[11+i*6] = '7'; pbuff[12+i*6] = '5';
	      break;
	  }
	  k /= 4;
	  if (k>=10) pbuff[8+i*6] = (k/10) + '0';
	  pbuff[9+i*6] = (k % 10) + '0';
       }
   }
   pri_str(pbuff); crlf();

   wis_str(pbuff);
   pbuff[7]='N';pbuff[8]='I'; pbuff[11]='N';pbuff[12]='L';
   for (i=0;i<15;i++) pbuff[15+i*4]=i+'A';  pbuff[73]='\0';
   pri_str(pbuff);

   l=0;
   for (i =0; i<15;i++) {
      if (cdata.wedge[i]>0) {
	 wis_str( pbuff );

	 pbuff[3]=( (i+1) % 10)+'0';
	 if ( (i+1)>=10)
	    pbuff[2]=( (i+1) /10)+'0';

	 if (cdata.wedge[i] >=10)
	    pbuff[77]= (cdata.wedge[i]) /10 +'0';
	 pbuff[78]= (cdata.wedge[i] %10) + '0';

	 for (j=0;j<=16;j++) {
	    for (k=0;k<3;k++){
	       pbuff[7+k+j*4]=matrix[l].lig[k];
	    }
	    switch (matrix[l].srt) {
	       case 0: pbuff[6+j*4]=' '; break;
	       case 1: pbuff[6+j*4]='/'; break;
	       case 2: pbuff[6+j*4]='.'; break;
	       case 3: pbuff[6+j*4]=':'; break;
	    }
	    l++;
	 }
	 for (k=0;k<79;k++)
	    _bios_printer(_PRINTER_WRITE,LPT1,pbuff[k]);
	 _bios_printer(_PRINTER_WRITE,LPT1,13);
	 _bios_printer(_PRINTER_WRITE,LPT1,10);
      }
   }
}

void ontsnap(char r[])
{
  char cc;
  print_at(24,0,r);
  printf(" # ");
  cc = getchar();
  if (cc=='#') exit(1);
}

void scherm(void)
{
    int i;

    cls();
    print_at( 1,18,   "***********************************************");
    for (i=2;i<=22;i++)
       print_at( i,18,"*                                             *");
    print_at(23,18,   "***********************************************");
}

/*
     printing on a certain position on the screen
 */

void print_at(int rij, int kolom, char *buf)
{
    _settextposition( rij , kolom );
    _outtext( buf );
}

/*
     clear screen
 */
void cls()
{
   _clearscreen(_GCLEARSCREEN);
}

/*
   int get_line

   returns : length pf the read string + 1
 */
int get_line(   )
{
   int c,i;
   int limit;

   limit = MAX_REGELS;
   i=0;
   while ( --limit > 0 && (c=getchar()) != EOF && c != '\n')
       r_buff [i++]=c;
   if (c == '\n')
       r_buff[i++] = c;
   r_buff[i] = '\0';
   return ( i );
}

unsigned int lees_lig(void)
{
   char cc, c1;
   unsigned int lt;

   do {
       print_at(22,20,"                      ");
       print_at(22,20,"ligature      :");
       lt = get_line();
   }
     while (lt>4);

   return(lt);
}


/*
   convert :

    change french accents e' e` e^ e" etc. in the matrix
 */
void convert( struct matrijs *m )
{
    char cc, c1;

    cc = m -> lig[0];
    c1 = m -> lig[1];

      switch ( cc ) {
	case 'A':
	  switch ( c1 ) {
	    case 'E':
	      m -> lig[0] = '\222'; /*AE*/ m -> lig[1] = '\0';
	      break;
	    case '"' :
	      m -> lig[0] = '\216'; /*A"*/ m -> lig[1] = '\0';
	      break;
	  }
	  break;
	case 'E':
	  switch ( c1 ) {
	    case 39 :
	      m -> lig[0] = '\220'; /*E'*/ m -> lig[1] = '\0';
	      break;
	  }
	  break;
	case 'O':
	  if ( c1 == '"' ) {
	    m -> lig[0] = '\231'; /* O"*/ m -> lig[1] = '\0';
	  }
	  break;
	case 'U':
	  if ( c1 == '"' ) {
	    m -> lig[0] = '\232'; /* U"*/ m -> lig[1] = '\0';
	  }
	  break;
	case 's':
	  if ( c1 == 'z' ) {
	    m -> lig[0] = '\341'; /* sz */ m -> lig[1] = '\0';
	  }
	  break;
	case 'a':
	  switch (c1) {
	    case 'e' : m -> lig[0] = '\221'; /*ae*/ m -> lig[1] ='\0';
	  break;
	    case  39 : m -> lig[0] = '\240'; /*e'*/ m -> lig[1] ='\0';
	      break;
	    case '^' : m -> lig[0] = '\203'; /*e^*/ m -> lig[1] ='\0';
	      break;
	    case  96 : m -> lig[0] = '\205'; /*e`*/ m -> lig[1] ='\0';
	      break;
	    case '"' : m -> lig[0] = '\204'; /*e"*/ m -> lig[1] ='\0';
	      break;
	  }
	  break ;
	case 'e':
	  switch ( c1 ) {
	    case  39 : m -> lig[0] = '\202'; /*e'*/ m -> lig[1] = '\0' ;
	      break;
	    case '^' : m -> lig[0] = '\210'; /*e^*/ m -> lig[1] = '\0' ;
	      break;
	    case  96 : m -> lig[0] = '\212'; /*e`*/ m -> lig[1] = '\0' ;
	      break;
	    case '"' : m -> lig[0] = '\211'; /*e"*/ m -> lig[1] = '\0' ;
	      break;
	  }
	  break ;
	case 'i':
	  switch ( c1 ) {
	    case  39 : m -> lig[0] = '\241'; /*i'*/ m -> lig[1] = '\0' ;
	      break;
	    case 'j' : m -> lig[0] = '\230'; /*ij */ m -> lig[1] = '\0' ;
	      break;
	    case '^' : m -> lig[0] = '\214'; /*i^*/ m -> lig[1] = '\0' ;
	      break;
	    case  96 : m -> lig[0] = '\215'; /*i`*/ m -> lig[1] = '\0' ;
	      break;
	    case '"' : m -> lig[0] = '\213'; /*i"*/ m -> lig[1] = '\0' ;
	      break;
	  }
	  break ;
	case 'o':
	  switch ( c1 ) {
	    case  39 : m -> lig[0] = '\242'; /*o'*/ m -> lig[1] = '\0' ;
	      break;
	    case '^' : m -> lig[0] = '\223'; /*o^*/ m -> lig[1] = '\0' ;
	      break;
	    case  96 : m -> lig[0] = '\225'; /*o`*/ m -> lig[1] = '\0' ;
	      break;
	    case '"' : m -> lig[0] = '\224'; /*o"*/ m -> lig[1] = '\0' ;
	      break;
	  }
	  break;
	case 'u':
	  switch ( c1 ) {
	    case  39 : m -> lig[0] = '\243'; /*u'*/ m -> lig[1] = '\0' ;
	      break;
	    case '^' : m -> lig[0] = '\226'; /*u^*/ m -> lig[1] = '\0' ;
	      break;
	    case  96 : m -> lig[0] = '\227'; /*u`*/ m -> lig[1] = '\0' ;
	      break;
	    case '"' : m -> lig[0] = '\201'; /*u"*/ m -> lig[1] = '\0' ;
	      break;
	  }
	  break ;
	case 'C':
	  if ( c1 == '!') {
	    m -> lig[0] = '\200'; /* C-cedille */
	    m -> lig[1] = '\0' ;
	  }
	  break;
	case 'c':
	  if ( c1 == '!' ) {
	    m -> lig[0] = '\207'; /* c-cedille */
	    m -> lig[1] = '\0' ;
	  }
	  break;
	case 'n':
	  if ( c1 == '~' ) {
	    m -> lig[0] = '\244'; /* n-tilde */
	    m -> lig[1] = '\0' ;
	  }
	  break;
	case 'N':
	  if ( c1 == '~' ) {
	    m -> lig[0] = '\245'; /* N-tilde */
	    m -> lig[1] = '\0' ;
	  }
	  break;
      }
}

/*
   lees_srt :
   read: roman / italic / small caps / bold .....

 */
unsigned char lees_srt( char *b  )
{
   unsigned char cc, lt;

   do {
	 print_at(23,20,"                     ");
	 print_at(23,20,"kind r/i/s/b  :");
	 get_line();
	 cc=r_buff[0];
   }
   while (cc !='r' && cc !='i' && cc != 's' && cc != 'b' );
   switch (cc) {
       case 'r': lt = 0; break;  /* roman      */
       case 'i': lt = 1; break;  /* italic     */
       case 's': lt = 2; break;  /* small caps */
       case 'b': lt = 3; break;  /* bold       */
   }
   if ( (lt == 2) && (b[0] > 64) && (b[0] < 91) ) {
       lt = 0 ;    /* only lower case small caps */
   }

   return(lt);
}

unsigned char lees_width(unsigned char min)
{
   unsigned char lt;

   do {
     print_at(24,20,"                    ");
     print_at(24,20,"width (units) :");
     get_line();
     lt = atoi(r_buff);
     if (lt == 0)
	lt = min + 2;
   }
    while (lt < min || lt >30 );

   return(lt);
}

/*
      reads matrix file from disc

      moet nog getest......

*/
char r_eading()
{
    char reda = 0;
    FILE  *fpin ;
    int c ;
    size_t recsize = sizeof( filerec );
    size_t recs2   = sizeof( cdata  );
    fpos_t  *recpos, *fp;
    int p, handle;
    long int length, recseek;
    int i,j;
    char inpath[_MAX_PATH];
    long int aantal_records;

    cls();

    print_at(10,10,"matrix file van schijf lezen ");


    /* cdata lezen */

    /* records lezen verder zover het kan */


    i = 0;
    do {
       print_at(12,10,"enter the same name   : \n");
       print_at(13,10,"Enter input file name:   " ); gets( inpath );
       if( ( fpin = fopen( inpath, "rb" )) == NULL )
       {
	  i++;
	  if ( i==1) {
	     print_at(15,10,"Can't open input file");
	     printf(" %2d time\n",i );
	  } else {
	     print_at(15,10,"Can't open input file");
	     printf(" %2d times\n",i );
	  }
	  if (i == 10) return(0) ;
       }
    }
      while ( fpin == NULL );

    printf("listing of coding file: %s \n",inpath);

    fclose(fpin);

    handle = open( inpath,O_BINARY |O_RDONLY );
    /* Get and print length. */

    length = filelength( handle );
    printf( "File length of %s is: %ld \n", inpath, length );

    close(handle);

    fpin = fopen( inpath, "rb" )   ;

    aantal_records = length / recsize ;

    /* global : mnumb = number of mats in the mat-case */
    /*
	printf("The file contains %7d records ",aantal_records);
	getchar();
	printf("Now the contents of the file will follow, \n");
	printf("from start to finish \n\n");
	getchar();
	cls();
    */


		    /* first cdata 70 bytes */
    p =  0 * recs2 ;
    *fp = ( fpos_t ) ( p ) ;
    fsetpos( fpin , fp );
    fread( &cdata, recs2 , 1, fpin );

    for (i=0;i<34;i++)
	namestr[i] = cdata.cnaam[i] ;
    for (i=0;i<16;i++) wig[i] = cdata.wedge[i];
    nrows = ( wig[15]==0 ) ? 15 : 16 ;

    i = 0;
    for (recseek = 10; recseek <= aantal_records -11;
		      recseek ++ ){

	    p =  recseek  * recsize;
	    *fp = ( fpos_t ) ( p ) ;
	    fsetpos( fpin , fp );
	    fread( &filerec, recsize, 1, fpin );

	    for (j=0;j<3;j++)
	       matrix[i].lig[j] = filerec.lig[j] ;
	    matrix[i].srt    = filerec.srt;
	    matrix[i].w      = filerec.w  ;
	    matrix[i].mrij   = filerec.mrij ;
	    matrix[i].mkolom = filerec.mkolom ;

	    i++;
    }
    fclose(fpin);

    reda = 1;
    return (reda );
}

/*
    writes matrix-file on disc

    getest 28-12-2003 ...
*/

int schrijf()
{
    FILE  *fpout ;
    size_t recsize = sizeof( filerec );
    size_t recs2   = sizeof( cdata  );
    fpos_t  *fp;
    int i,j;
    char outpath[_MAX_PATH];
    char antw;
    int rtvalue = -1;  /* error-handling */

    /* hier was ik */

    cls();

    print_at(5,10,"Write matrix-file to disk ");

    /* cdata schrijven */

    /* 272 records schrijven */

    do {
	print_at(7,10,"write file      ? y/n : ");
	get_line();
	antw = r_buff[0];
    }
      while ( antw != 'n' && antw != 'y' );

    if (antw == 'y' ) {

	print_at( 9,10,"give proper directions");
	print_at(10,10,"Enter output file name :" );
	gets( outpath );
	if( ( fpout = fopen( outpath, "wb+" )) == NULL )
	{
	   print_at(13,10,"Can't open output file" );
	   get_line();
	   return ( rtvalue );
	}
					/* write first cdata to disk */
	fwrite( &cdata , recs2, 1, fpout );
					/* next the array */
	for( i = 0; i < 272 ; i++ )
	{

	   for (j=0;j<3;j++)
	       filerec.lig[j] = matrix[i].lig[j];
	   filerec.srt    = matrix[i].srt ;
	   filerec.w      = matrix[i].w ;
	   filerec.mrij   = matrix[i].mrij ;
	   filerec.mkolom = matrix[i].mkolom;

	   fwrite( &filerec, recsize, 1, fpout );
	}
	fclose (fpout);
	rtvalue = 1;

    }
    return( rtvalue );

    /*
    FILE  *fpout ;
    size_t recsize = sizeof( filerec );
    size_t recs2   = sizeof( cdata  );
    fpos_t  *fp;
    int i,j;
    char cc ;
    char outpath[_MAX_PATH];
    char antw;
    int rtvalue = -1; */ /* error-handling */

}


/* GETCH.C illustrates how to process ASCII or extended keys.
 * Functions illustrated include:
 *      getch           getche
 */


void getchmain()
{
    int key;

    /* Read and display keys until ESC is pressed. */
    while( 1 )
    {
	/* If first key is 0, then get second extended. */
	key = getch();
	if( (key == 0) || (key == 0xe0) )
	{
	    key = getch();
	    printf( "ASCII: no\tChar: NA\t" );
	}

	/* Otherwise there's only one key. */
	else

	    printf( "ASCII: yes\tChar: %c \t", isgraph( key ) ? key : ' ' );

	printf( "Decimal: %d\tHex: %X\n", key, key );

	/* Echo character response to prompt. */
	if( key == 27)
	{
	    printf( "Do you really want to quit? (Y/n) " );
	    key = getche();
	    printf( "\n" );
	    if( (toupper( key ) == 'Y') || (key == 13) )
		break;
	}
    }
}

/*
  scherm2 ()
    display skeleton on screen

    28-12-2003
*/
void scherm2()
{
    int i;
    char c;

    cls();

    for (i=0;i<=16;i++){
       print_at(3,7+i*4,"");
       pri_coln(i);
    }

    if (nrows > 16 ) nrows = 16;

    for (i=0;i<=nrows-1;i++){
       print_at(i+4,1,"");  printf("%2d",i+1) ;
       print_at(i+4,78,""); printf("%2d",wig[i]);
    }
}

void scherm3( void)
{

    double fx;
    int i;

    print_at(20,10,"corps: ");
    for (i=0;i<10;i++) {
      if ( cdata.corps[i]>0 )  {
	 fx = (double) cdata.corps[i];
	 printf("%5.2f ", fx / 2. );
      }
       else
	 printf("      ");
    }
    print_at(21,10,"set  : ");
    for (i=0;i<10;i++) {
      if ( cdata.csets[i]>0 ) {
	 fx = (double) cdata.csets[i];
	 printf("%5.2f ", fx * .25 );
      }
       else
	 printf("      ");
    }
}

void pri_lig( struct matrijs *m )
{
   unsigned int i, j;

   i = m -> mrij;
   j = m -> mkolom;

   print_at(4+i,6+j*4,"    ");
   print_at(4+i,6+j*4,"");
   switch ( m -> srt ) {
     case 0 : printf(" "); break;
     case 1 : printf("/"); break;
     case 2 : printf("."); break;
     case 3 : printf(":"); break;
   }
   printf("%1c%1c%1c",
      m -> lig[0],
      m -> lig[1],
      m -> lig[2] );
}


/*
   reads a new matrix into the memory

    28-12-2003

 */

char nieuw()
{
   char     nieuw = 0;
   unsigned char c;
   char     cb[4];
   unsigned char lt;
   int      i,j,k,nn,nx;
   unsigned char iwig,ss;
   double   nf;

   cls();

   print_at(2,20,"Reading the matrix-layout");
   print_at(4,20,"Name font ");
   lt = get_line();

   if ( lt >= 34 ) lt =33; /* not to long */
   for (i=0;i<lt-1;i++) {
     namestr[i]     = r_buff[i];
     cdata.cnaam[i] = r_buff[i];
   }
   namestr[lt]   ='\0';
   cdata.cnaam[i]='\0';

   do {
       print_at(6,20,"number of rows 15/16 ");
       get_line();
       nrows = atoi (r_buff);
   }
      while ( (nrows <15) || ( nrows >16) );

   print_at(8,10,"Wedge :");

   for (i=0;i<=15;i++){ /* reset to zero */
      wig[i]=0;
      cdata.wedge[i]=0;
   }
   for (i=0;i<=nrows-1;i++) {
     do {
	 print_at(14,20,"wedge row ");
	 printf("%2d = ",i+1);
	 print_at(14,35,"    ");
	 print_at(14,35," ");
	 get_line();

	 iwig = atoi(r_buff);
	 print_at(8,19 +i*3," ");

	 printf("%2d",i+1);
     }
       while ( (iwig < 5 ) || (iwig > 25 ) );

     wig[i] = iwig;
     cdata.wedge[i] = iwig;

     print_at( 9,19 +i*3," ");
     printf("%2d",iwig);
   }

   print_at(14,20,"                       ");

   /* read corps and set-numbers */

   print_at(23,20,"                            ");
   print_at(24,20,"                            ");
   do {
      print_at(22,20,"                            ");
      print_at(22,20,"number of sizes :");
      get_line();
      nn = atoi(r_buff);
   }
   while ( (nn<0) || (nn >10) );

   if (nn != 0) {
      for (i=0;i<= nn-1;i++) {
	 do {
	   print_at(23,20,"                            ");
	   print_at(23,20,"corps : ");
	   get_line();
	   nf = atof(r_buff);
	 }
	   while (nf <4 || nf >14);
	 nx = (int) ( nf * 2 +.5);
	 cdata.corps[i]= (char) nx;
	 do {
	   print_at(24,20,"                            ");
	   print_at(24,20,"set   : ");
	   get_line();
	   nf = atof(r_buff);
	 }
	   while (nf <4 || nf >20);
	 nx = (int) (nf * 4 + .25);
	 cdata.csets[i]= (char) nx;
      }
   }
   scherm2();
   scherm3();

   for (i = 0; i<=nrows - 1 ;i++){
     for (j=0;j<= 16  ;j++) {

	print_at(22,20,"row "); printf("%2d",i+1);
	print_at(22,28,"col ");
	pri_coln(j);

	for (k=0;k<3;k++) {
	   matrix[i+j*17].lig[k]='\0';
	   cb[k]='\0';
	}
	lt = lees_lig();

	for (k=0;k<lt-1;k++) {
	   matrix[i+j*17].lig[k] = r_buff[k];
	   cb[k]=r_buff[ k ];
	}
	if (lt == 3) {  /* convert ligatures */
	      convert( &matrix[i+j*17] );
	}

	matrix[i+j*17].srt    = lees_srt( cb );
	matrix[i+j*17].w      = lees_width( wig[i]-2 );
	matrix[i+j*17].mrij   = i;
	matrix[i+j*17].mkolom = j;

	pri_lig( & matrix[i+j*17] );

	print_at(22,20,"                            ");
	print_at(23,20,"                            ");
	print_at(24,20,"                            ");

	/* ontsnap("nieuw korte loop ");*/
     }
   }

   return (1);
}

/*
   askcol:  asks the column-name

   NI= 0,  NL=1 other combinations Nx = 15
   A-O = 2-16

   version 27-12-2003

 */
unsigned int askcol()
{
    unsigned int i;
    char c, c1;

    do {
       i = - 2;
       do {
	 print_at(23,20,"                    ");
	 print_at(23,20,"column = ");
	 get_line();
	 c = r_buff[0];
       } while ( c != 'A' && c != 'B' && c != 'C' && c != 'D' && c != 'E'
	      && c != 'F' && c != 'G' && c != 'H' && c != 'I' && c != 'J'
	      && c != 'K' && c != 'L' && c != 'M' && c != 'N' && c != 'O' );
       switch (c) {
	  case 'N' :
	    c1 = r_buff[1];
	    switch (c1) {
	       case 'I' : i =  0; break;
	       case 'L' : i =  1; break;
	       default  : i = 15; break ;
	    }
	    break;
	  default :
	    i = c - 'A' + 2 ;
	    break;
       }
    }
      while ( !( (i >= 0 ) && (i <= 16) ) );

    return (i);
}

/*
   askrow: ask row number: input integer

      0 will stop the input
      input 1-15 or 1-16 depending on 15 or 16 rows (=nrows)
      output is according C-array ar[n] = ar[0] to ar[n-1]

    version 27-12-2003

 */
unsigned int askrow( void )
{
   unsigned int r;

   do {
     print_at(22,20,"                      ");
     print_at(22,20,"row  (0=stop) = ");
     get_line();
     r = atoi(r_buff);
   }
     while ( ! ( (r >= 0) && (r< nrows ) ) );

   return(r-1);
}
/*

  editen = change matrix-layout

  27 -12-2003

  only 17 * 16 matrix, no mats outside yet....

 */
void editen()
{
   char ce;
   unsigned char ss;
   unsigned int erow, ecol;
   unsigned int nr, lt;
   int k, er, ec;

   displaym();
   do {
      er = askrow();            /* ask row ? */

      if ( er >= 0 ) {
	  erow = er;
	  ecol = askcol( );     /* ask column */

	  nr = ecol + erow * 17;
	  matrix [nr].srt    = 0;
	  matrix [nr].w      = wig[erow];

	  lt = lees_lig();      /* read ligatuur */
	  for (k=0;k<3;k++)
	    matrix[nr].lig[k]='\0';
	  for (k=0;k<lt-1;k++) {
	    matrix[nr].lig[k] = r_buff[k];
	  }
	  if (lt == 3) {
	      convert( & matrix[nr] );
	  }
	  matrix[nr].srt    = lees_srt(matrix[nr].lig);
	  matrix[nr].w      = lees_width( wig[erow]-2 );
	  pri_lig( &matrix[nr] );
      }
      /* einde if */
   }
      while ( er != -1 );
}

/*
   displaym: display the existing matrix

   28-12-2003

 */
void displaym()
{
    int i,j;
    double fx;
    char c;

    /*
      print_at(20,20," in displaym");
      printf("Maxm = %4d ",maxm);
      ontsnap("displaym");
     */

    scherm2();

    print_at(1,10," ");
    for (i=0; i<33 && ( (c=namestr[i]) != '\0') ; i++)
	printf("%1c",c);


    for (i=0; i< 272 ; i++){
	 pri_lig( & matrix[i] );
    }

    scherm3();

    print_at(24,10," einde display: ");
    get_line();

}



/*  standard matrix

    standard matrices to choose from

    this will be larger in time

    version 28-12-2003
*/

char standaard()
{
   char st = 0;
   int i, maxm;
   char c;

   cls();

   print_at( 8,30,"Standaard matrix ");
   print_at(10,32,         "cochin = c");
   print_at(11,30,       "garamond = g");
   print_at(12,33,          "dante = d");
   print_at(13,27,    "baskerville = b");

   /*
   print_at(14,23,"Times new roman = t");
   print_at(15,33,          "Bembo = B");
    */

   do {
      print_at(20,27,"    command = ");
      get_line();
      c = r_buff[0];
   }
     while ( c != 'c' && c != 'g' && c != '#'
	 && c != 'd' && c != 'b'  /* && c != 'B' && b != t */
	);

   switch (c) {
      case 'd' : /* dante */
	 cdata = stdante12 ;
	 for (i=0;i<16;i++) {
	    wig[i] = cdata.wedge[i];
	 }
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;
	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = stdante[i];
	 }
	 break;
      case 'g' :
	 cdata = stand ;
	 for (i=0;i<16;i++)
	    wig[i] = stand.wedge[i];
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;

	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = stmatrix[i];
	 }
	 break;
      case 'c' :
	 cdata = stcochin ;
	 for (i=0;i<16;i++)
	    wig[i] = stcochin.wedge[i];
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;

	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = cochin[i];
	 }
	 break;
      case 'b' :
	 cdata = stbaskerv ;
	 for (i=0;i<16;i++)
	    wig[i] = stbaskerv.wedge[i];
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;
	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = baskerville[i];
	 }
	 break;
      case 'B' :
	 cdata = stand ;
	 for (i=0;i<16;i++)
	    wig[i] = stand.wedge[i];
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;

	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = stmatrix[i];
	 }
	 break;
      case 't' :
	 cdata = stand ;
	 for (i=0;i<16;i++)
	    wig[i] = stand.wedge[i];
	 nrows = ( wig[15]==0 ) ? 15 : 16 ;
	 maxm = (nrows == 15) ? 256 : 272 ;

	 for ( i=0 ; i < maxm - 1 ;i++) {
	    matrix[i] = stmatrix[i];
	 }
	 break;
   }
   if (c != '#' ) {
      for (i=0;i<maxm -1 ; i++)
	  convert(& matrix[i]);
      for (i=0;i<33;i++)
	  namestr[i]=cdata.cnaam[i];
      displaym();
      st = 1;
   }
   return(st);
}

char menu (char gelezen )
{
    char c;
    cls();
    scherm();
    do {
       print_at( 4,25,"Manipulation Layout Matrix-cases");
       print_at( 5,25,"              for");
       print_at( 6,25,"  MONOTYPE Composition casting");
       print_at( 9,35," menu Matrix ");
       print_at(11,38,"read = r");
       print_at(12,34,"standard = s");
       print_at(13,38," new = n");

       if (gelezen == 1) {
	  print_at(14,38,   "edit = e");
	  print_at(15,36, " write = w");
	  print_at(16,36, " print = p");
	  print_at(17,35,"display = d");
       }
       print_at(19,38,"(end = #)");
       print_at(21,35,"command = ");
       get_line();
       c = r_buff[0];
   }
    while (c != 'r' && c != 'w' && c != 's'
	&& c != 'p' && c != 'd' && c != 'e'
	&& c != 'n' && c != '#' );

   return(c);
}


main ()
{
    char cmenu;
    char gelezen = 0;
    intro();
    do {
       cmenu = menu(gelezen);
       switch (cmenu) {
	  case 'd' : /* display matrix on screen */
	     if (gelezen == 1) {
		 displaym();
		 print_at(24,10," einde display: ");
		 get_line();
	     }
	     break;
	  case 'p' : /* print matrix */
	     if (gelezen == 1) maprint();
	     break;
	  case 'r' : /* read file from disk */
	     gelezen = r_eading();
	     break;
	  case 'e' : /* edit matrix */
	     if (gelezen == 1) editen();
	     break;
	  case 'n' : /* read new matrix from console */
	     gelezen = nieuw();
	     break;
	  case 'w' : /* write matrix to disk */
	     if (gelezen == 1 ) schrijf();
	     break;
	  case 's' : /* use standaard matrix
			  garamond 156/174/201 series */
	     gelezen = standaard();
	     break;
       }
    }
       while (cmenu != '#');

    exit(1);
}













